FROM jetty:latest
MAINTAINER info.inspectit@novatec-gmbh.de

# set Workdir
WORKDIR /opt

# set insepctit env 
ENV INSPECTIT_AGENT_HOME /opt/agent
ENV INSPECTIT_CONFIG_HOME /opt/agent/active-config
# inspectit jvm options. Jetty automatically appends the content of the variable JAVA_OPTIONS at startup of the jvm
ENV JAVA_OPTIONS -Xbootclasspath/p:${INSPECTIT_AGENT_HOME}/inspectit-agent.jar -javaagent:${INSPECTIT_AGENT_HOME}/inspectit-agent.jar -Dinspectit.config=${INSPECTIT_CONFIG_HOME}


# Add Sample App to hot deployment directory
ADD hello2.war /var/lib/jetty/webapps/

# adding fresh agent from jenkins workspace
ADD ${WORKSPACE}/inspectIT/agent/inspectit-agent-sun1.5.zip /opt/

# unzip agent and clean up .zip-file
RUN unzip inspectit-agent-sun1.5.zip \
&& rm -f inspectit-agent-sun1.5.zip 

# copy start script and agent config
COPY runscripts/run-jetty-with-inspectit.sh /run-jetty-with-inspectit.sh
COPY ${WORKSPACE}/inspectIT/agent/config /opt/agent/active-config


# define default command for container startup
CMD /run-jetty-with-inspectit.sh

